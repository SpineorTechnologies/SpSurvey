<script type="text/ng-template" id="tag-template">
  <div class="tag-template">
    <div class="left-panel">
      <img ng-src="http://mbenford.github.io/ngTagsInput/images/flags/{{data.flag}}" ng-if="data.flag"/>
    </div>
    <div class="right-panel">
      <span>{{$getDisplayText()}}</span>
      <a class="remove-button" ng-click="$removeTag()">&#10006;</a>
    </div>
  </div>
</script>

<script type="text/ng-template" id="autocomplete-template">
  <div class="autocomplete-template">
    <div class="left-panel">
      <img ng-src="http://mbenford.github.io/ngTagsInput/images/flags/{{data.flag}}" />
    </div>
    <div class="right-panel">
      <span ng-bind-html="$highlight($getDisplayText())"></span>
      <span>({{data.rank}})</span>
      <span>{{data.confederation}}</span>
    </div>
  </div>
</script>
<div id="context-menu">
  <ul class="dropdown-menu" role="menu">
    <li><a tabindex="-1" ng-click="addParticipant()">Add Participant</a></li>
    <!--<li><a tabindex="-1" ng-click="removeParticipant()" >Remove Participant</a></li>-->
  </ul>
</div>
 <!--<div class="modal fade" id="validateDlg" tabindex="-1" role="dialog" aria-labelledby="validateDlg" >
      <div class="modal-dialog">
          <div class="modal-content">
          <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="material-icons">close</i></button>
              <h4 class="modal-title">{{validateDlgTitle}}</h4>
          </div>
          <div class="modal-body">
              {{validateDlgMsg}}     
          </div>
          </div>
      </div>
 </div>      -->
<script type="text/ng-template" id="queryBuilderDirective.html">

</script>

<!--<div class="modal fade" id="queryBuider" tabindex="-1" role="dialog" aria-labelledby="dlaLabel" >
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="material-icons">close</i></button>
        <h4 class="modal-title" id='queryBuiderModalTitle'></h4>
      </div>
      <flash-message name="queryBuilder-Flash"></flash-message> 
      <div class="modal-body">
	  <span ng-bind-html="outpurResult"></span>

       <div id="builder"></div>
   	
      </div>
      <div class="modal-footer">
        <button type="button" ng-click="updateQuery()" class="md-button md-primary"> Submit </button>
      </div>
    </div>
  </div>
</div>-->

<div class="modal fade" id="queryBuider" tabindex="-1" role="dialog" aria-labelledby="dlaLabel" >
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="material-icons">close</i></button>
        <h4 class="modal-title" id='queryBuiderModalTitle'></h4>
      </div>
      <div class="flash_alert1" id="participantsTabAlert">
        <div id="alertType1" class="alert alert-dismissible alertIn alertOut">
            <div type="button" class="close closeButton" close-flash="4">
                <span aria-hidden="true">×</span>
                <span class="sr-only">Close</span>
            </div>
            <span class="dinamicText"><span> </span></span>
        </div>
    </div> 
      <div class="modal-body">
	  <span ng-bind-html="outpurResult"></span>

       <div id="builder"></div>
   	
      </div>
      <div class="modal-footer">
        <button type="button" onclick="js_updateQuery()" class="md-button md-primary"> Submit </button>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="downloadOptions" tabindex="-1" role="dialog" aria-labelledby="dlaLabel" >
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header" style="height: 50px;">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="material-icons">close</i></button>
      <h4 class="modal-title">Download</h4>
      </div> 
      <div class="modal-body">
	  <span ng-bind-html="outpurResult"></span>
		<button type="button" ng-click="downloadXls(false)" class="md-button  md-primary btn-block"> Download Participants Sheet DLA </button>
		<button type="button" ng-click="downloadXls(true)" class="md-button md-default btn-block"> Download Participants </button><br>
      </div>
    </div>
  </div>
</div>
<!--  Content -->
<!--------------------------------------->
<!-- Conversion Modal -->
<!--
<flash-message
  duration="5000"
  show-close="true"
  show-close="true"
  show-close="true"
  on-dismiss="myCallback(flash);"
></flash-message>-->


<!--<flash-message id="participantsTabAlert"
               on-dismiss="runQueryBuilder_v1('reset');"
               show-close="true" >
</flash-message>-->
<div class="flash_alert" id="participantsTabAlert">
    <div id="alertType" class="alert alert-dismissible alertIn alertOut">
        <div type="button" class="close closeButton" close-flash="4">
            <span aria-hidden="true">×</span>
            <span class="sr-only">Close</span>
        </div>
        <span class="dinamicText"><span>Data Updated </span></span>
    </div>
</div> 
<!-- Conversion Modal -->
<div class="modal fade" id="conversions" tabindex="-1" role="dialog" aria-labelledby="conversionsLabel" >
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="material-icons">close</i></button>
        <h4 class="modal-title">Conversions</h4>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-md-6">
            <div class="select_dropdown">
              <select ng-model="demographic.selected" ng-options="demographicsArray.displayName for demographicsArray in demographicsArray track by demographicsArray.field" class="form-control"></select>
            </div>
          </div>
          <div class="col-md-4 col-md-offset-2">
            <div class="panel-action-items text-right">
              <button class="md-button md-icon-button"><i class="fa fa-upload panel_icons"></i></button> <button class="md-button md-icon-button "><i class="fa fa-download panel_icons"></i></button>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-12">
            <div class="table_block ">
              <div class="mdtTableContainer table-container">
                <table width="100%" border="0" cellspacing="0" cellpadding="0" class="conversion_table">
                  <thead>
                  <tr>
                    <th>From <i class="fa fa-sort"></i></th>
                    <th>To <i class="fa fa-sort"></i></th>
                    <th>Type <i class="fa fa-sort"></i></th>
                    <th>Action</th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr ng-repeat="conversion in demographic.selected.conversions">
                    <td><input class="form-control" ng-model="demographic.selected.conversions[$index].from" type="text" value="{{conversion.from}}"/></td>
                    <td><input class="form-control" ng-model="demographic.selected.conversions[$index].to" type="text" value="{{conversion.to}}"/></td>
                    <td>
                      <div class="select_dropdown">
                        <select ng-model="demographic.selected.conversions[$index].type" class="form-control">
                          <option ng-repeat="type in demographicsSelectedTypeArray"  value="{{type}}">{{type}}</option>

                        </select>
                      </div>
                    </td>
                    <td class="text-center"><button class="md-button md-icon-button txt_accent"><i class="fa fa-trash-o"></i></button></td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <a class="link pull-left txt_accent" ng-click="addConversion()" > <i class="fa fa-plus-circle" ></i> Add a Conversion </a>
        <button type="button" class="md-button md-primary" ng-click="saveConversions()"> Save changes </button>
      </div>
    </div>
  </div>
</div>

<!-- /Conversion Modal -->

<!-- Modal -->
<section class="content_block build_survey_cnt"  id="participantsTab" ng-cloak>

  <div class="participants_block h-100">
    <div class="container-fluid h-100">
      <div class="row">
        <div class="col-md-12">
          <div class="title_block" layout="row">
            <h4 class="md-headline pull-left" style="margin-top:0;">User List</h4>
          </div>
        </div>
      </div>

      <div class="row h-100">
        <div class="col-md-12 h-100">
          <div class="panel panel-default h-100">
            <div class="panel-heading no-brdr">
              <div class="panel-action-items">
                <div class="title_block_actions pull-right">

         <!--         <input  data-my-Directive type="file" name="file"  id="uploadFileInput" accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel"  style="display: none" >-->

 				<button class="md-icon-button md-button txt_green" title='Add Participant' ng-click="addParticipant()"><i class="fa fa-plus panel_icons"></i></button>
 					
                  <button class="md-icon-button md-button txt_green" ng-click="triggerUploadFile()"><i class="fa fa-upload panel_icons"></i></button>

                  <!-- <button class="md-icon-button md-button txt_green" data-target="#uploadOptions" data-toggle="modal"><i class="fa fa-upload panel_icons"></i></button> -->

                  <button class="md-icon-button md-button txt_green hidden" style="display: none" id="uploadExcelFile" ngf-select="uploadExcelFile($file)"><i class="fa fa-upload panel_icons"></i></button>

                  <!-- <button class="md-icon-button md-button txt_green"  ng-click="downloadXls()" type="button"><i class="fa fa-download panel_icons"></i></button> -->
                  <button class="md-icon-button md-button txt_green" data-target="#downloadOptions" data-toggle="modal"><i class="fa fa-download panel_icons"></i></button>
                  <div class="dropdown" style="display: inline-block;">
                            <button class="md-icon-button md-button txt_green" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" ">
                            <svg class="panel_icons" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" width="18px" height="18px" style="enable-background:new 0 0 20 20; fill:#909090; line-height:20px; margin-top:3px;" xml:space="preserve">
                                        <g>
                                            <path d="M0.4,8.8v2.5h10.3l-0.5-2.5H0.4z M0.4,8.8"></path>
                                            <path d="M0.4,15.4v2.5h16.5v-2.3c-0.2,0-0.3-0.1-0.5-0.2H0.4z M0.4,15.4"></path>
                                            <path d="M10.1,2.6l3.4,2h3.3V2.1H0.4v2.5h8.8L8.9,3.5L10.1,2.6z M10.1,2.6"></path>
                                            <path d="M10.2,3.8L10,3.9l2.4,10.6l1.9-3.2l2,2.8c0.4,0.5,1.1,0.7,1.5,0.3c0.5-0.3,0.5-1,0.1-1.6l-2-2.8l3.7-0.8L10.2,3.8z
                                                 M10.2,3.8"></path>
                                        </g>
                                        </svg> 
                             </button>
                            <ul class="dropdown-menu dropdown-menu-right" role="menu" style=" max-height:160px; overflow:auto;" >
                                <li  ng-repeat="x in columns">                                
                                <span ng-if="x.displayName.length>0" style="padding:0 15px; " ><input ng-if="x.displayName.length>0" type="checkbox" ng-model="showAllColumns"  ng-true-value="{{x.display}}" ng-click="showHideColumsClickHandler(x,x.display?false:true)"/> &nbsp;  {{x.displayName}} </span>
                                </li>
                            </ul> 
                        </div>
                  <button class="md-icon-button md-button txt_green" type="button" ng-click="clearAll()"><i
                  class="fa fa-filter panel_icons"></i></button>
              </div>
              </div>
            </div>
            <div class="panel-body">
              <div class="table_block ">
                <div class="mdtTableContainer table-container">
                  <div id="myModal" class="modal fade" role="dialog" style="z-index: 100000;">
                    <div class="modal-dialog">
                    <!-- Modal content-->
 						<div class="modal-content">
                        <div class="modal-header">
                          <button type="button" class="close" data-dismiss="modal">&times;</button>
                          <h4 class="modal-title">Add Field</h4>
                        </div>

                        <div class="modal-body">
                          <form name="myForm" ng-submit="addColumn(myForm.$valid)" novalidate autocomplete="off">
                             <flash-message name="add-column"></flash-message> 
                            <div class="form-group">
                              <label for="field">Field Name *</label>
                              <span ng-show="myForm.field.$invalid && !myForm.field.$pristine" class="help-block">Field Name  is required.</span>
                              <input type="text" ng-model="newfield.field" class="form-control form-controlModel"
                                     id="field" name="field" required>
                            </div>
                            <div class="form-group">
                              <label for="displayName">Field Display Name *</label>
                              <span ng-show="myForm.displayName.$invalid && !myForm.field.$pristine" class="help-block">Field Display Name is required.</span>
                              <input type="text" ng-model="newfield.displayName" class="form-control form-controlModel"
                                     id="displayName" name="displayName" required>
                            </div>
                            <div class="form-group">
                              <label for="fieldtype">Field Type :</label>
                              <select class="form-controlModel" id="fieldtype" ng-model="newfield.dataType">
                                <option value="integer">Integer</option>
                                <option value="string" ng-selected="true">String</option>
                                <option value="date">Date</option>
                              </select>
                            </div>

                            <button type="submit"
                              ng-disabled="myForm.field.$dirty && myForm.field.$invalid || myForm.displayName.$dirty && myForm.displayName.$invalid"
                              type="button" class="md-button md-primary btn-block">Add column
                            </button>
                          </form>
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        </div>
                      </div>

                      <!--model end  -->
                    </div>
                  </div>
                  <table width="100%"  border="0" cellspacing="0" cellpadding="0"
                         class="user_list_table draggable sortable" id="myTable" >
                     <thead>
                    <tr>
                      <th ng-repeat="column in columns" id="{{column.field}}"
                          ng-show="column.display == true" style="text-align: center;"
                          ng-class="{'accept': column.field !='status' && column.field !='settings' && column.field !='actions'}" class="thminwidth" ng-if="column.field !='skip'">
                         <span ng-if="column.field !='skip'|| column.field !='settings'|| column.field !='actions'" class="dragHandleCol" style=" cursor: move;">{{column.displayName}}</span>
                        <i ng-if="column.field !='skip'|| column.field !='settings'"
                           ng-click="toggleSort($index);$event.stopPropagation()"
                           ng-class="{'fa fa-sort': columns[$index].sort == '','fa fa-sort-asc': columns[$index].sort ==1 ,'fa fa-sort-desc': columns[$index].sort == -1 }">

                        </i>
                         <i ng-if="column.fieldtype=='new'" class="fa fa-minus-circle" aria-hidden="true" ng-click="deleteColumn($index,column.field)"></i> 
                        <i   ng-if="column.fieldtype=='new' || column.fieldtype=='demographic'  || column.fieldtype=='languageList'" class="fa fa-code panel_icons" ng-click="conversions(column.field)" style="font-weight:bold;color: rgba(255, 161, 45, 0.5)"></i>
                      </th>

                      <th id="skip">

                        <i class="fa fa-plus-circle" data-toggle="modal" data-target="#myModal"></i>
                      </th>

                    </tr>
                    </thead>

                    <tbody>
                    <tr>
                      <td ng-repeat="column in columns" ng-if="column.display == true">
                        <input search
                               ng-if="column.field!='status' && column.display == true && column.field!='skip' && column.field!='settings' && column.field !='actions'"
                               class="table_search"
                               placeholder="Search"
                               ng-model="columns[$index].search"
                               ng-change="searchChange($index)">

                      <div ng-if="column.field == 'status' && column.display == true" class="togglebutton"><label>
                         <input type="checkbox" ng-model="makeAllActive"  ng-click="updatechecboxFieldAll(field[column.field],field._id) ">All ON/OFF </label></div>

                      </td>
                    </tr>
                    
                    </tbody>
                  </table>
                </div>
              </div>
              <div class="table_paging_block clearfix" style="height: 100px;"> 

                <!--
                            <pagination direction-links="false" total-items="200" ng-model="pagination.currentPage" num-pages="10"></pagination>
                -->

                <ul id="pagination"
                    class="pull-right"
                    uib-pagination direction-links="true" boundary-links="true"
                    items-per-page="limit"
                    total-items="total"
                    max-size="5" boundary-link-numbers="true"  previous-text="&lsaquo;" next-text="&rsaquo;" first-text="&laquo;" last-text="&raquo;"
                    ng-model="pagination.currentPage"
                    ng-change="pageChanged()"></ul>


                <p ng-if="total != 0" class="pull-left">Displaying <span class="txt_green"> {{recCurrentIndex}}</span> to <span
                  class="txt_green">{{recLastIndex}} </span> out of <span
                  class="txt_green">{{total}}</span> rows <span class="txt_green">
                 <!--  <select ng-model="recordsPerpage" ng-change="recordvalchange()">
                    <option ng-repeat="x in limitpage" value="{{x}}">{{x}}</option>
                  </select> -->
                  <select ng-model="recordsPerpage" ng-options="x for x in limitpage" ng-change="recordvalchange(recordsPerpage)"></select>
                  </span> Records per page
                </p>
                <p ng-if="total == 0" class="pull-left">
                  <span class="txt_green"> No Records Found !</span>
              </p>

              </div>

            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

</section>
<script src="scripts/participants/jquery-resizable.min.js"></script>
<script src="scripts/participants/jquery-resizableTableColumns.js"></script>
<!--
<script src="bower_components/angular-jq-querybuilder/dist/AngularJqueryQueryBuilderDirective.js"></script>
-->

<script>
  $.material.init();
  $("#pagination").removeClass('pagination');
  $(".context").contextmenu({
    target:'#context-menu',
    before: function(e,context) {
      // addParticipant()
      alert($(e.target).text());
      // execute code before context menu if shown
    },
    onItem: function (context, e) {
      alert($(e.target).html());
    }
  });


</script>
<style>
#role_dropdown > .md-button{ border: 1px solid #ddd; font-weight: 400; margin: 0!important; }
#role_dropdown > .md-button > .truncate{ 
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: inline-block; max-width: 105px; min-width: 105px; text-transform:lowercase; font-weight: mormal; float:center;}
#role_dropdown > .dropdown-menu{ background-color: #fff!important; border: 1px solid #ddd;}
#uploadOptions > .modal-dialog{width: 300px }
</style>
<style>
  .autocomplete-list{ width: 150px; overflow: auto;}
  #mdtTableContainer {
    max-height: 320px;
    overflow: auto;
	}
	.togglebutton label input[type=checkbox] {
	 width:auto !important; 
	 height:auto !important; 
	}
.flash_alert{
    position: absolute;
    left: 0;
    right: 0;
    top: 10%;
    width: 80%;
    margin: auto;
    z-index: 1;
    display: none;  
  } 
 .flash_alert1{
   z-index: 1;
   display: none;
 }
.ui-autocomplete {
  max-height: 200px;
  overflow-y: auto;
  /* prevent horizontal scrollbar */
  overflow-x: hidden;
  /* add padding to account for vertical scrollbar */
  padding-right: 20px;
} 
.mdtTableContainer  {
    position: relative;
}
li .JCLRFlex{
  min-width: auto!important
}
.rules-group-body .btn-success[data-add="group"]{
       display:none;
}
 
#pagination .disabled a{
  cursor:not-allowed;
}
#pagination .pagination-first a, #pagination .pagination-prev a, #pagination .pagination-next a, #pagination .pagination-last a{
  display: block;
}
</style> 

